function formatTimestamp(e){return new Date(1e3*e).toLocaleString("fr-FR")}const containerBloc=document.querySelector(".touit"),form=document.querySelector("#form"),pseudo=document.querySelector("#pseudo"),message=document.querySelector("#message"),btnEnvoyer=document.querySelector("#ajouter"),containerBest=document.querySelector(".top-touit");function addTouit(e,t,n,o,s,a){const c=document.createElement("div");c.className="touit-cards",c.id=a;const i=document.createElement("div");i.className="cards-content";const r=document.createElement("div");r.className="touit-pseudo",r.textContent=e;const d=document.createElement("button");d.className="btnOpen";const u=document.createElement("p");u.className="content",u.textContent=t;const l=document.createElement("footer");l.className="flex";const m=document.createElement("div");m.className="touit-like flex";const p=document.createElement("p");p.textContent=n;const f=document.createElement("button");f.className="btnLike";const g=document.createElement("img");g.src="assets/img/heart.svg";const E=document.createElement("div");E.className="touit-comment flex";const C=document.createElement("p");C.textContent=o;const h=document.createElement("button");h.className="btnComment";const v=document.createElement("img");v.src="assets/img/bulle-de-chat.svg";const L=document.createElement("p");L.className="touit-date",L.textContent=formatTimestamp(s),containerBloc.prepend(c),c.appendChild(i),i.appendChild(r),i.appendChild(d),i.appendChild(l),d.appendChild(u),l.appendChild(m),l.appendChild(E),m.appendChild(p),m.appendChild(f),E.appendChild(C),E.appendChild(h),f.appendChild(g),h.appendChild(v),c.appendChild(L),f.addEventListener("click",function(){f.classList.toggle("active"),f.classList.contains("active")?(addLike(function(){getOneTouit(function(e){p.textContent=e.data.likes},function(){console.log("Erreur")},c.id)},function(){console.log("Erreur")},c.id),g.src="assets/img/heartColor.svg"):(deleteLike(function(){getOneTouit(function(e){p.textContent=e.data.likes},function(){console.log("Erreur")},c.id)},function(){console.log("Erreur")},c.id),g.src="assets/img/heart.svg")}),c.addEventListener("mouseenter",function(){getOneTouit(function(e){p.textContent=e.data.likes},function(){console.log("Erreur")},c.id)})}function getTouit(t,n,e){const o=new XMLHttpRequest;o.open("GET","http://touiteur.cefim-formation.org/list?ts="+e,!0),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))}),o.send()}form.addEventListener("submit",function(e){e.preventDefault(),sendTouit(function(){console.log("Le message a bien été envoyé")},function(){console.log("erreur lors de l'envoi")},pseudo.value,message.value),pseudo.value=null,message.value=null});const error=document.querySelector(".error");let timestamp=0;function getOneTouit(t,n,e){const o=new XMLHttpRequest;o.open("GET","http://touiteur.cefim-formation.org/get?id="+e,!0),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))}),o.send()}function addBestTouit(e,t,n,o,s,a){const c=document.createElement("div");c.className="touit-cards",c.id=a;const i=document.createElement("div");i.className="cards-content";const r=document.createElement("div");r.className="touit-pseudo",r.textContent=e;const d=document.createElement("button");d.className="btnOpen";const u=document.createElement("p");u.className="content",u.textContent=t;const l=document.createElement("footer");l.className="flex";const m=document.createElement("div");m.className="touit-like flex";const p=document.createElement("p");p.textContent=n;const f=document.createElement("button");f.className="btnLike";const g=document.createElement("img");g.src="assets/img/heart.svg";const E=document.createElement("div");E.className="touit-comment flex";const C=document.createElement("p");C.textContent=o;const h=document.createElement("button");h.className="btnComment";const v=document.createElement("img");v.src="assets/img/bulle-de-chat.svg";const L=document.createElement("p");L.className="touit-date",L.textContent=formatTimestamp(s),containerBest.prepend(c),c.appendChild(i),i.appendChild(r),i.appendChild(d),i.appendChild(l),d.appendChild(u),l.appendChild(m),l.appendChild(E),m.appendChild(p),m.appendChild(f),E.appendChild(C),E.appendChild(h),f.appendChild(g),h.appendChild(v),c.appendChild(L),f.addEventListener("click",function(){f.classList.toggle("active"),f.classList.contains("active")?(addLike(function(){getOneTouit(function(e){p.textContent=e.data.likes},function(){console.log("Erreur")},c.id)},function(){console.log("Erreur")},c.id),g.src="assets/img/heartColor.svg"):(deleteLike(function(){getOneTouit(function(e){p.textContent=e.data.likes},function(){console.log("Erreur")},c.id)},function(){console.log("Erreur")},c.id),g.src="assets/img/heart.svg")}),c.addEventListener("mouseenter",function(){getOneTouit(function(e){p.textContent=e.data.likes},function(){console.log("Erreur")},c.id)})}function topTouit(t,n,e){const o=new XMLHttpRequest;o.open("GET","http://touiteur.cefim-formation.org/likes/top?count="+e,!0),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))}),o.send()}function sendTouit(t,n,e,o){const s=new XMLHttpRequest;s.open("POST","http://touiteur.cefim-formation.org/send",!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.addEventListener("readystatechange",function(){var e;s.readyState===XMLHttpRequest.DONE&&(200===s.status?(e=JSON.parse(s.responseText),t(e)):n(status))});o="name="+e+"&message="+o;s.send(o)}function addLike(t,n,e){const o=new XMLHttpRequest;o.open("PUT","http://touiteur.cefim-formation.org/likes/send",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))});e="message_id="+e;o.send(e)}function deleteLike(t,n,e){const o=new XMLHttpRequest;o.open("DELETE","http://touiteur.cefim-formation.org/likes/remove",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))});e="message_id="+e;o.send(e)}setInterval(function(){getTouit(function(e){for(timestamp=e.ts,i=0;i<e.messages.length;i++)addTouit(e.messages[i].name,e.messages[i].message,e.messages[i].likes,e.messages[i].comments_count,e.messages[i].ts,e.messages[i].id)},function(){error.textContent="Erreur lors de la récupération des touits !",error.style.color="red"},timestamp)},2e3),topTouit(function(e){for(y=0;y<e.top.length;y++)addBestTouit(e.top[y].name,e.top[y].message,e.top[y].likes,e.top[y].comments_count,e.top[y].ts,e.top[y].id)},function(){error.textContent="Erreur lors de la récupération des besttouits !",error.style.color="red"},2);const containerTrending=document.querySelector(".trending");function addTrending(e){const t=document.createElement("ul");t.className="flex";const n=document.createElement("li");n.textContent=e,containerTrending.appendChild(t),t.appendChild(n)}function trending(t,n){const o=new XMLHttpRequest;o.open("GET","http://touiteur.cefim-formation.org/trending",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.addEventListener("readystatechange",function(){var e;o.readyState===XMLHttpRequest.DONE&&(200===o.status?(e=JSON.parse(o.responseText),t(e)):n(status))}),o.send()}trending(function(e){for(j=0;j<7;j++)console.log(e)},function(){console.log("Erreur")});